apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: heimdall-nfs
    namespace: democratic-csi
spec:
    interval: 15m
    chart:
        spec:
            chart: democratic-csi
            version: 0.14.6
            sourceRef:
                kind: HelmRepository
                name: democratic-csi
                namespace: flux-system
            interval: 15m
    timeout: 20m
    maxHistory: 3
    driftDetection:
        mode: warn
    install:
        createNamespace: true
        remediation:
            retries: 3
    upgrade:
        cleanupOnFail: true
        remediation:
            retries: 3
    uninstall:
        keepHistory: false
    values:
        csiDriver:
            # should be globally unique for a given cluster
            name: org.democratic-csi.nfs
            fsGroupPolicy: File
        # add note here about volume expansion requirements
        storageClasses:
            - name: heimdall-nfs-csi
              defaultClass: true
              reclaimPolicy: Delete
              volumeBindingMode: Immediate
              allowVolumeExpansion: true
              parameters:
                # for block-based storage can be ext3, ext4, xfs
                # for nfs should be nfs
                fsType: nfs
                # if true, volumes created from other snapshots will be
                # zfs send/received instead of zfs cloned
                detachedVolumesFromSnapshots: "false"
                # if true, volumes created from other volumes will be
                # zfs send/received instead of zfs cloned
                # detachedVolumesFromVolumes: "false"
              mountOptions:
                - noatime
                - nfsvers=3
                - nolock
              secrets:
                provisioner-secret: null
                controller-publish-secret: null
                node-stage-secret: null
                node-publish-secret: null
                controller-expand-secret: null
        # if your cluster supports snapshots you may enable below
        volumeSnapshotClasses:
            - name: heimdall-nfs-snapshot-csi
              parameters:
                #  # if true, snapshots will be created with zfs send/receive
                detachedSnapshots: "true"
        #  secrets:
        #    snapshotter-secret:
        driver:
            config:
                driver: zfs-generic-nfs
                sshConnection:
                    host: 10.1.0.63
                    port: 22
                    username: root
                    # use either password or key
                    privateKey: ENC[AES256_GCM,data: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,iv:tcCGV6BLZMV6E8CirU8oaGNTxsO6KitKauooWEOLVg8=,tag:yKzW75bL1kN4pCfwwKhKhQ==,type:str]
                zfs:
                    # can be used to override defaults if necessary
                    # the example below is useful for TrueNAS 12
                    cli:
                        #  sudoEnabled: true
                        paths:
                            zfs: /usr/sbin/zfs
                            zpool: /usr/sbin/zpool
                            sudo: /usr/bin/sudo
                            chroot: /usr/sbin/chroot
                    # can be used to set arbitrary values on the dataset/zvol
                    # can use handlebars templates with the parameters from the storage class/CO
                    #datasetProperties:
                    #  "org.freenas:description": "{{ parameters.[csi.storage.k8s.io/pvc/namespace] }}/{{ parameters.[csi.storage.k8s.io/pvc/name] }}"
                    #  "org.freenas:test": "{{ parameters.foo }}"
                    #  "org.freenas:test2": "some value"
                    datasetParentName: Heimdall/k8s/main-cluster
                    # do NOT make datasetParentName and detachedSnapshotsDatasetParentName overlap
                    # they may be siblings, but neither should be nested in the other
                    # do NOT comment this option out even if you don't plan to use snapshots, just leave it with dummy value
                    detachedSnapshotsDatasetParentName: Heimdall/k8s/main-cluster-snapshots
                    datasetEnableQuotas: true
                    datasetEnableReservation: false
                    datasetPermissionsMode: "0777"
                    datasetPermissionsUser: 0
                    datasetPermissionsGroup: 0
                    #datasetPermissionsAcls:
                    #- "-m everyone@:full_set:allow"
                    #- "-m u:kube:full_set:allow"
                nfs:
                    # https://docs.oracle.com/cd/E23824_01/html/821-1448/gayne.html
                    # https://www.hiroom2.com/2016/05/18/ubuntu-16-04-share-zfs-storage-via-nfs-smb/
                    shareStrategy: setDatasetProperties
                    shareStrategySetDatasetProperties:
                        properties:
                            #sharenfs: "rw,no_subtree_check,no_root_squash"
                            sharenfs: "on"
                            # share: ""
                    shareHost: 10.1.0.63
                    shareAlldirs: false
                    shareAllowedHosts: []
                    shareAllowedNetworks: 10.1.0.0/24
                    shareMaprootUser: root
                    shareMaprootGroup: root
                    shareMapallUser: ""
                    shareMapallGroup: ""
sops:
    shamir_threshold: 3
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1agltukf6ellg2guets9gq4th2nmunc965uflry7fdahtj7ea8uxq8q54ae
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBrZ1hmQmxTMzdTd0VhQlJE
            VlZHc1lEaGIreHdDTGF4TFNLSVIzbGhMcERzCmY1Z2FSMnZUTUZ2VjdKNG1EZlVs
            bE5IYUhIK2ZCYTR0bThqVjBidkQ4Y3cKLS0tIHE5UWI2OGI0L29PVWxRZkR3YWM2
            RCtpRnZuTE5sRWs3b3ltSE9IZjFtTW8K0r/Do1jxMrUzqWaW83iETS6FxexitcWB
            xXR/O26fEKzAlWONyu240DcOFx5dPriQo0Mwt/kzSPPI88UFaEWI4w==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-11-03T02:06:57Z"
    mac: ENC[AES256_GCM,data:K05eVHHNBNB0do/NRm7V7CQq0BYqWFQuzGd32IKDYi/NmOpxDCYWrNB28/EhqpwBD3yaX3KIJ1FFc/hcjMnZHDOcW+D2Sn+3n7NSDV5CxSwHdMBzsX+XOlrhkGYyQSgtJOrU55c3o1D4S/0EMtZalpYas+1V7pqDR+8afNj2r1c=,iv:tv/PqrTDUPku96G0LtVz5/hjSs8LyVWEcVm955AQKSI=,tag:IShDLQPOZM0pF1e+orMLFA==,type:str]
    pgp: []
    encrypted_regex: ((?i)(privateKey))
    version: 3.9.1
