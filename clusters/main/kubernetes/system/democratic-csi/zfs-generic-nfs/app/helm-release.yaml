apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: heimdall-nfs
    namespace: democratic-csi
spec:
    interval: 15m
    chart:
        spec:
            chart: democratic-csi
            version: 0.14.7
            sourceRef:
                kind: HelmRepository
                name: democratic-csi
                namespace: flux-system
            interval: 15m
    timeout: 20m
    maxHistory: 3
    driftDetection:
        mode: warn
    install:
        createNamespace: true
        remediation:
            retries: 3
    upgrade:
        cleanupOnFail: true
        remediation:
            retries: 3
    uninstall:
        keepHistory: false
    values:
        csiDriver:
            # should be globally unique for a given cluster
            name: org.democratic-csi.heimdall-nfs
            fsGroupPolicy: File
        # add note here about volume expansion requirements
        storageClasses:
            - name: heimdall-nfs-csi
              defaultClass: true
              reclaimPolicy: Delete
              volumeBindingMode: Immediate
              allowVolumeExpansion: true
              parameters:
                # for block-based storage can be ext3, ext4, xfs
                # for nfs should be nfs
                fsType: nfs
                # if true, volumes created from other snapshots will be
                # zfs send/received instead of zfs cloned
                detachedVolumesFromSnapshots: "false"
                # if true, volumes created from other volumes will be
                # zfs send/received instead of zfs cloned
                # detachedVolumesFromVolumes: "false"
              mountOptions:
                - nfsvers=4
                - tcp
                - intr
                - hard
                - noatime
                - nodiratime
                - nolock
              secrets:
                provisioner-secret: null
                controller-publish-secret: null
                node-stage-secret: null
                node-publish-secret: null
                controller-expand-secret: null
        # if your cluster supports snapshots you may enable below
        volumeSnapshotClasses:
            - name: heimdall-nfs-snapshot-csi
              annotations:
                snapshot.storage.kubernetes.io/is-default-class: "true"
              parameters:
                #  # if true, snapshots will be created with zfs send/receive
                detachedSnapshots: "true"
              secrets:
                snapshotter-secret: null
        driver:
            config:
                driver: zfs-generic-nfs
                sshConnection:
                    host: 10.1.0.63
                    port: 22
                    username: root
                    # use either password or key
                    privateKey: ENC[AES256_GCM,data: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,iv:sggmxHh4cYaxm9PXSw+4p6qy2w2mz9jnfoOwgEHdx6Y=,tag:9ubVCy1d0ZYbNOZD4fc2Qw==,type:str]
                zfs:
                    # can be used to override defaults if necessary
                    # the example below is useful for TrueNAS 12
                    cli:
                        #  sudoEnabled: true
                        paths:
                            zfs: /usr/sbin/zfs
                            zpool: /usr/sbin/zpool
                            sudo: /usr/bin/sudo
                            chroot: /usr/sbin/chroot
                    # can be used to set arbitrary values on the dataset/zvol
                    # can use handlebars templates with the parameters from the storage class/CO
                    datasetProperties:
                        org.freenas:description: '{{ parameters.[csi.storage.k8s.io/pvc/namespace] }}/{{ parameters.[csi.storage.k8s.io/pvc/name] }}'
                    datasetParentName: Heimdall/k8s/main-cluster/nfs/pvc
                    detachedSnapshotsDatasetParentName: Heimdall/k8s/main-cluster/nfs/snapshot
                    datasetEnableQuotas: false
                    datasetEnableReservation: false
                    datasetPermissionsMode: "0777"
                    datasetPermissionsUser: 0
                    datasetPermissionsGroup: 0
                    #datasetPermissionsAcls:
                    #- "-m everyone@:full_set:allow"
                    #- "-m u:kube:full_set:allow"
                nfs:
                    shareStrategy: setDatasetProperties
                    shareStrategySetDatasetProperties:
                        properties:
                            sharenfs: rw,no_subtree_check,no_root_squash
                    shareHost: 10.1.0.63
sops:
    shamir_threshold: 3
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1agltukf6ellg2guets9gq4th2nmunc965uflry7fdahtj7ea8uxq8q54ae
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBqUG9jZm54bnMxVThidVZK
            Z0ZKaWVMK1RCajZlY2pVais2QjJsME5ENDJBCnZwQWhsK1RxUjJlV1doWWtWRzF6
            eVpUUWtCb1dwL0hiT0szTnUybHZKMTQKLS0tIG1HOUdKUzZKOWV4NkdxazVFalps
            NkU0elVvbk9td052aDA3eTJpKytkcm8K9BChVbzZ/A1WroDPCvGgKCGgF+hAfZgB
            6U1uw0Nw1WgTTozubXR+feV7QCXmN+9cx4Zw9lsr5CytahLW6CWmog==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-26T01:41:13Z"
    mac: ENC[AES256_GCM,data:Tnd4agfxUPWTFtfqxiJSdX3mKpQKUqR1XWHuoL/AOHcHY6PBS02alB4NbZXU35gIJqSrOHANfAyy7zbrH4gpwzqybc0Wut1lIii+HDDWtBUWbsZOB41AkY9vevi3CLx6PzFwjCuzT66lILpokk0yJEak6gBgFSsa2//RcS74xvE=,iv:Ao36d07PrL/IlHELHE/YDhxE4RcbH2vJhdJCvDNbNfk=,tag:KSukfG+K5ltowpuGiKYvHg==,type:str]
    pgp: []
    encrypted_regex: ((?i)(privateKey))
    version: 3.9.1
