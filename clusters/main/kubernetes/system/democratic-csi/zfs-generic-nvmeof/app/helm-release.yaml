apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: heimdall-nvmeof
    namespace: democratic-csi
spec:
    interval: 15m
    chart:
        spec:
            chart: democratic-csi
            version: 0.14.7
            sourceRef:
                kind: HelmRepository
                name: democratic-csi
                namespace: flux-system
            interval: 15m
    timeout: 20m
    maxHistory: 3
    driftDetection:
        mode: warn
    install:
        createNamespace: true
        remediation:
            retries: 3
    upgrade:
        cleanupOnFail: true
        remediation:
            retries: 3
    uninstall:
        keepHistory: false
    values:
        csiDriver:
            name: org.democratic-csi.heimdall-nvmeof
        storageClasses:
            - name: heimdall-nvmeof-csi
              defaultClass: false
              reclaimPolicy: Delete
              volumeBindingMode: Immediate
              allowVolumeExpansion: true
              parameters:
                # for block-based storage can be ext3, ext4, xfs
                # for nfs should be nfs
                fsType: ext4
                detachedVolumesFromSnapshots: "false"
              mountOptions: []
              secrets:
                provisioner-secret: null
                controller-publish-secret: null
                node-stage-secret: null
                node-publish-secret: null
                controller-expand-secret: null
        volumeSnapshotClasses:
            - name: heimdall-nvmeof-csi
              parameters:
                detachedSnapshots: "true"
              secrets:
                snapshotter-secret: null
        driver:
            config:
                driver: zfs-generic-nvmeof
                sshConnection:
                    host: 10.1.0.63
                    port: 22
                    username: root
                    privateKey: ENC[AES256_GCM,data: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,iv:GoMz7uRR9zY68xeyPin3uEn6lmUKDb4uleyguVbCeIQ=,tag:3WJU1ZLvDPdKams9zPmFkw==,type:str]
                zfs:
                    cli:
                        #  sudoEnabled: true
                        paths:
                            zfs: /usr/sbin/zfs
                            zpool: /usr/sbin/zpool
                            sudo: /usr/bin/sudo
                            chroot: /usr/sbin/chroot
                    datasetProperties:
                        org.freenas:description: '{{ parameters.[csi.storage.k8s.io/pvc/namespace] }}/{{ parameters.[csi.storage.k8s.io/pvc/name] }}'
                    datasetParentName: Heimdall/k8s/main-cluster/nvme/pvc
                    detachedSnapshotsDatasetParentName: Heimdall/k8s/main-cluster/nvme/snapshot
                    # "" (inherit), lz4, gzip-9, etc
                    zvolCompression: inherit
                    # "" (inherit), on, off, verify
                    zvolDedup: inherit
                    zvolEnableReservation: false
                    # 512, 1K, 2K, 4K, 8K, 16K, 64K, 128K default is 16K
                    zvolBlocksize: 4K
                nvmeof:
                    # these are for the node/client aspect
                    transports:
                        - tcp://10.1.0.63:4420
                        #- "tcp://127.0.0.1:4420?host-iface=eth0"
                        #- "tcp://[2001:123:456::1]:4420"
                        #- "rdma://127.0.0.1:4420"
                        #- "fc://[nn-0x203b00a098cbcac6:pn-0x203d00a098cbcac6]"
                    # MUST ensure uniqueness
                    # full iqn limit is 223 bytes, plan accordingly
                    # default is "{{ name }}"
                    nameTemplate: '{{ parameters.[csi.storage.k8s.io/pvc/namespace] }}-{{ parameters.[csi.storage.k8s.io/pvc/name] }}'
                    namePrefix: csi-
                    nameSuffix: -cluster
                    shareStrategy: nvmetCli
                    #shareStrategy: "spdkCli"
                    # https://documentation.suse.com/es-es/sles/15-SP1/html/SLES-all/cha-nvmeof.html
                    # https://www.linuxjournal.com/content/data-flash-part-iii-nvme-over-fabrics-using-tcp
                    # http://git.infradead.org/users/hch/nvmetcli.git
                    shareStrategyNvmetCli:
                        #sudoEnabled: true
                        # /root/.local/bin/nvmetcli
                        nvmetcliPath: nvmetcli
                        # prevent startup race conditions by ensuring the config on disk has been imported
                        # before we start messing with things
                        configIsImportedFilePath: /var/run/nvmet-config-loaded
                        configPath: /etc/nvmet/config.json
                        basename: nqn.2003-01.org.linux-nvme
                        # add more ports here as appropriate if you have multipath
                        ports:
                            - "1"
                        subsystem:
                            attributes:
                                allow_any_host: 1
                                # not supported yet in nvmetcli
                                #namespace:
                                #  attributes:
                                #    buffered_io: 1
                    shareStrategySpdkCli:
                        # spdkcli.py
                        #spdkcliPath: spdkcli
                        configPath: /etc/spdk/spdk.json
                        basename: nqn.2003-01.org.linux-nvmeof
                        bdev:
                            type: uring
                            #type: aio
                            attributes:
                                block_size: 512
                        subsystem:
                            attributes:
                                allow_any_host: "true"
                        listeners:
                            - trtype: tcp
                              traddr: server
                              trsvcid: port
                              adrfam: ipv4
sops:
    shamir_threshold: 3
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1agltukf6ellg2guets9gq4th2nmunc965uflry7fdahtj7ea8uxq8q54ae
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBnNUVGUnhlRXNnR29wOUd0
            Sk9EaFdITmlDczFTbFF2aFRGVjFyTmt4dkVnCjlMaDdYZDdnTEZwcnFFM0hiMVZz
            eWlYZ252cm9iVWI4UHo4NEJTMkFHbm8KLS0tIEczaWZPcm9wNmkzcG0wS3lSc2hU
            ZTFwK2xQNjl0S3VhNFM3bGoweVVGcWsK7BrXUIrLoIGn9BlPkQ4bHprDmR2dLuXU
            AkiRvPT0wNNAZkDwTx4wuRnHYBakBzuQHsOk5azQG2PiI7hQO5KDAw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-26T01:56:13Z"
    mac: ENC[AES256_GCM,data:3AaZW+5UWdr3vXh7jZEGpvUe7/BqugtFLb8gpVW+HsRuUexKQsnqpOU6vCW2IZ1eN6ObDQy0zZQ7QHykB/UQp15kXSW7NdY1fmaZ9i3fMifnR1NGMQ5I3OOSAgGMVsUhGt+3I9I60LQTNIm7gYBXP256w0AlzyldScALJ5RsPLE=,iv:28mcu92dEI5jwo1wtiVCCXpDm89noZceZEEm+NigwNY=,tag:+20g0GeVwTh7q/EQ5+IrcQ==,type:str]
    pgp: []
    encrypted_regex: ((?i)(privateKey))
    version: 3.9.1
