apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: heimdall-nvmeof
    namespace: democratic-csi
spec:
    interval: 15m
    chart:
        spec:
            chart: democratic-csi
            version: 0.14.7
            sourceRef:
                kind: HelmRepository
                name: democratic-csi
                namespace: flux-system
            interval: 15m
    timeout: 20m
    maxHistory: 3
    driftDetection:
        mode: warn
    install:
        createNamespace: true
        remediation:
            retries: 3
    upgrade:
        cleanupOnFail: true
        remediation:
            retries: 3
    uninstall:
        keepHistory: false
    values:
        csiDriver:
            name: org.democratic-csi.heimdall-nvmeof
        storageClasses:
            - name: heimdall-nvmeof-csi
              defaultClass: false
              reclaimPolicy: Delete
              volumeBindingMode: Immediate
              allowVolumeExpansion: true
              parameters:
                # for block-based storage can be ext3, ext4, xfs
                # for nfs should be nfs
                fsType: ext4
                detachedVolumesFromSnapshots: "false"
              mountOptions: []
              secrets:
                provisioner-secret: null
                controller-publish-secret: null
                node-stage-secret: null
                node-publish-secret: null
                controller-expand-secret: null
        volumeSnapshotClasses:
            - name: heimdall-nvmeof-csi
              parameters:
                detachedSnapshots: "true"
              secrets:
                snapshotter-secret: null
        driver:
            config:
                driver: zfs-generic-nvmeof
                sshConnection:
                    host: 10.1.0.63
                    port: 22
                    username: root
                    privateKey: ENC[AES256_GCM,data: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,iv:N3rhBa2IRqZ10hKRT3RW2vJDZwxDXGsHakBTsaHdjBs=,tag:cUPgXkoRmpaKJlJe7kUJqA==,type:str]
                zfs:
                    cli:
                        #  sudoEnabled: true
                        paths:
                            zfs: /usr/sbin/zfs
                            zpool: /usr/sbin/zpool
                            sudo: /usr/bin/sudo
                            chroot: /usr/sbin/chroot
                    datasetProperties:
                        org.freenas:description: '{{ parameters.[csi.storage.k8s.io/pvc/namespace] }}/{{ parameters.[csi.storage.k8s.io/pvc/name] }}'
                    datasetParentName: Heimdall/k8s/main-cluster/nvme/pvc
                    detachedSnapshotsDatasetParentName: Heimdall/k8s/main-cluster/nvme/snapshot
                    # "" (inherit), lz4, gzip-9, etc
                    zvolCompression: inherit
                    # "" (inherit), on, off, verify
                    zvolDedup: inherit
                    zvolEnableReservation: false
                    # 512, 1K, 2K, 4K, 8K, 16K, 64K, 128K default is 16K
                    zvolBlocksize: 4K
                nvmeof:
                    # these are for the node/client aspect
                    transports:
                        - tcp://10.1.0.63:4420
                        #- "tcp://127.0.0.1:4420?host-iface=eth0"
                        #- "tcp://[2001:123:456::1]:4420"
                        #- "rdma://127.0.0.1:4420"
                        #- "fc://[nn-0x203b00a098cbcac6:pn-0x203d00a098cbcac6]"
                    # MUST ensure uniqueness
                    # full iqn limit is 223 bytes, plan accordingly
                    # default is "{{ name }}"
                    nameTemplate: '{{ parameters.[csi.storage.k8s.io/pvc/namespace] }}-{{ parameters.[csi.storage.k8s.io/pvc/name] }}'
                    namePrefix: csi-
                    nameSuffix: -cluster
                    shareStrategy: nvmetCli
                    #shareStrategy: "spdkCli"
                    # https://documentation.suse.com/es-es/sles/15-SP1/html/SLES-all/cha-nvmeof.html
                    # https://www.linuxjournal.com/content/data-flash-part-iii-nvme-over-fabrics-using-tcp
                    # http://git.infradead.org/users/hch/nvmetcli.git
                    shareStrategyNvmetCli:
                        #sudoEnabled: true
                        # /root/.local/bin/nvmetcli
                        nvmetcliPath: nvmetcli
                        # prevent startup race conditions by ensuring the config on disk has been imported
                        # before we start messing with things
                        configIsImportedFilePath: /var/run/nvmet-config-loaded
                        configPath: /etc/nvmet/config.json
                        basename: nqn.2003-01.org.linux-nvme
                        # add more ports here as appropriate if you have multipath
                        ports:
                            - "1"
                        subsystem:
                            attributes:
                                allow_any_host: 1
                                # not supported yet in nvmetcli
                                #namespace:
                                #  attributes:
                                #    buffered_io: 1
                    shareStrategySpdkCli:
                        # spdkcli.py
                        #spdkcliPath: spdkcli
                        configPath: /etc/spdk/spdk.json
                        basename: nqn.2003-01.org.linux-nvmeof
                        bdev:
                            type: uring
                            #type: aio
                            attributes:
                                block_size: 512
                        subsystem:
                            attributes:
                                allow_any_host: "true"
                        listeners:
                            - trtype: tcp
                              traddr: server
                              trsvcid: port
                              adrfam: ipv4
sops:
    shamir_threshold: 3
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1agltukf6ellg2guets9gq4th2nmunc965uflry7fdahtj7ea8uxq8q54ae
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAwcUdXWkZsYktvbWNWMkY5
            dmZPS0ZaajBSbG5iWVZXTXBCa0hGbm1FSWhvCkpiOVFMTVY4dVNZbmZVRkpZK1dQ
            MC93Y2x1TFhPWXo2ZTlTVzNOVUpCSkkKLS0tIFBXRHhEVHZKc2lMM1UxVWdkNVkw
            ZWtaa2RxT2I0ODBYd042angxbjFxN2sKqtmijwtfu1B/u0TrUMpavBnuZ3tTZjWW
            M99aDEjZLaAgyXQS3naxrkTq3cjqb+esSrz8VS+yW6+lPXhXeGeHrA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-26T01:49:37Z"
    mac: ENC[AES256_GCM,data:2x6395Iw354P2BwP9wE/aIlP4/ERoE8zg4NeR56hqyHwH/5h82hLWUclL6ziXCB+Q2mDqGgL55QBrMxbaQ8LiHBNk0K+Ea2lPehuabLPv2RKSg5mOyhmFEJAWZ4U/1QGBuW/Cv2ca43UUOj/oxxxhZtjtVEtOBHwmjKHnSoH11I=,iv:72tj6cD7MltUUdcwTQfTeOE+XcNPtYP9sxpdhc0FPn0=,tag:7eABi9VjVqcWC/zGsH2qyA==,type:str]
    pgp: []
    encrypted_regex: ((?i)(privateKey))
    version: 3.9.1
